import{JNode,JMain}from"./jqre.js";class Dialog{constructor(i){let e={applyStyle:!0,closeOnModalClick:!0,autoOpen:!0,closeOnEscape:!0,modal:!1,preventBodyScroll:!0};for(const t in e)i.hasOwnProperty(t)?this[t]=1==i[t]:this[t]=e[t];for(const e of["beforeClose","close","create","open"])"function"==typeof i[e]?this["f_"+e]=i[e].bind(this):this["f_"+e]=null;this.classes={};for(const e of["ui-dialog-container","ui-dialog-overlay","ui-dialog"])"object"==typeof i.classes&&null!==i.classes&&"string"==typeof i.classes[e]&&i.classes[e]?this.classes[e]=i.classes[e]:this.classes[e]=e;this.originalElement=(new JNode).add(i.el),e={width:this.originalElement.width()+"px",height:this.originalElement.height()+"px",minWidth:"150px",minHeight:"150px",maxWidth:"none",maxHeight:"none"};for(const t in e)i[t]?this[t]=isNaN(i[t])?i[t]:i[t]+"px":this[t]=e[t];this.widget=(new JNode).add("<div></div>").addClass(this.classes["ui-dialog-container"]),this.applyStyle&&this.widget.css({position:"fixed",top:0,left:0,width:"100%",height:"100%","z-index":10,display:"none","align-items":"center","justify-content":"center"}),this.modal&&(this.widget.append('<div class="'+this.classes["ui-dialog-overlay"]+'"></div>'),this.applyStyle&&this.widget.children().css({position:"absolute",top:0,left:0,width:"100%",height:"100%","z-index":10,background:"rgba(0, 0, 0, 0.5)"}),this.closeOnModalClick&&this.widget.children().on("click",(()=>{this.close()}))),this.widget.append('<div class="'+this.classes["ui-dialog"]+'"></div>'),this.applyStyle&&this.widget.children().last().css({position:"relative",display:"inline-block",width:this.width,height:this.width,"min-width":this.minWidth,"max-width":this.maxWidth,"min-height":this.minHeight,"max-height":this.maxHeight,"z-index":11,background:"#fff",overflow:"hidden auto","overscroll-behavior":"contain"}),this.widget.children().last().append(this.originalElement),this.keyDownFunction=i=>{"Escape"===i.key&&this.close()},this.closeOnEscape&&(new JNode).add(document.body).on("keydown",this.keyDownFunction),document.body.appendChild(this.widget[0]),this.f_create&&this.f_create(null,null),this.autoOpen&&this.open()}open(){"flex"!==this.widget.css("display")&&(this.widget.css("display","flex"),this.preventBodyScroll&&(new JNode).add("html,body").css("overflow","hidden"),this.f_open&&this.f_open(null,null))}close(){"none"!==this.widget.css("display")&&(this.f_beforeClose&&this.f_beforeClose(null,null),this.widget.css("display","none"),this.preventBodyScroll&&(new JNode).add("html,body").css("overflow",""),this.f_close&&this.f_close(null,null))}}Dialog.data=[],JNode.prototype.dialog=function(i){for(const e of this){if("object"==typeof i&&null!==i){i.el=e;const t=new Dialog(i);return e.dataset.uiDialog=Dialog.data.push(t)-1,this}if("string"==typeof i){const t=e.dataset.uiDialog;if(t&&Dialog.data[t]){const e=Dialog.data[t];switch(i){case"widget":return e.widget;case"instance":return e;case"isOpen":return"none"!==e.widget.css("display");case"open":e.open();break;case"close":e.close();break;case"destroy":e.closeOnEscape&&(new JNode).add(document.body).off("keydown",e.keyDownFunction),e.widget.remove(),Dialog.data[t]=null}continue}}break}return this};