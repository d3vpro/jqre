jQuery.extend({r:function(){class t{constructor(t){Object.defineProperty(this,"id",{value:t,writable:!1})}val(){let t=a.r.get(this.id);return/boolean|number|string/.test(typeof t)?t:JSON.parse(JSON.stringify(t))}set(t,e=void 0){return a.r.set(this.id,t,e)}unset(t=null){return null!==t&&a.r.unset(this.id,t)}}class e{constructor(t,a){let n,s=null;a.parent.length>0?(n=e.data.instances[a.parent].$el.find(a.el).first(),s=e.data.instances[a.parent]):n=jQuery(a.el).first(),Object.defineProperty(this,"$id",{value:t,writable:!1}),Object.defineProperty(this,"$el",{value:n,writable:!1}),Object.defineProperty(this,"$parent",{value:s,writable:!1}),Object.defineProperty(this,"$children",{value:{},writable:!0});for(const t in a.data)Object.defineProperty(this,t,{value:a.data[t],writable:!0});for(const t in a.methods)Object.defineProperty(this,t,{value:a.methods[t],writable:!0})}$emit(t,n=null){let s=this.$id;const r=s.split(".");for(;s.length;){if(e.data.instancesCustomEvents[s][t]){const r=e.delayRefresh;return r||(e.delayRefresh=!0),e.data.instancesCustomEvents[s][t].call(e.data.instances[s],n),r||(e.delayRefresh=!1,a.r.refresh(null)),!0}r.pop(),s=r.join(".")}return!1}$find(t){return this.$el.find(t)}$remove(t){const a=this.$el.find(t);a.length&&(e.data.instancesRestoreData[this.$id]||(e.data.instancesRestoreData[this.$id]={}),e.data.instancesRestoreData[this.$id][t]||(e.data.instancesRestoreData[this.$id][t]=[]));for(const[n,s]of a.toArray().entries()){let a=document.createComment(this.$id+" "+t+" "+n);s.parentNode.replaceChild(a,s),e.data.instancesRestoreData[this.$id][t].push({node:a,html:s})}}$restore(t){if(e.data.instancesRestoreData[this.$id]&&e.data.instancesRestoreData[this.$id][t]){for(const a of e.data.instancesRestoreData[this.$id][t])a.node.parentNode.replaceChild(a.html,a.node);delete e.data.instancesRestoreData[this.$id][t]}}static delayRefresh=!1;static refreshDelayedList=new Set;static reactiveMap=new WeakMap;static initReactive(n,s,r=!0){const i=new Proxy(n,{get(n,s){if("__isProxy"==s)return!0;const r=e.reactiveMap.get(n);let i;if(r.root){if(i=n[s],!(i instanceof t)){if("function"!=typeof i||["$emit","$find","$remove","$restore"].includes(s)){if("$children"==s){n[s]={};for(const t in e.data.instances)t.length>n.$id.length&&0===t.indexOf(n.$id)&&t.split(".").length===n.$id.split(".").length+1&&(n[s][t.substring(n.$id.length+1)]=e.data.instances[t]);return n[s]}return n[s]}return i.bind(r.proxy)}i=a.r.get(i.id)}else i=n[s];return"object"!=typeof i||null===i||i.__isProxy?i:e.reactiveMap.has(i)?e.reactiveMap.get(i).proxy:e.initReactive(i,r.root?r.path+"."+s:r.path,!1)},set(n,s,r){if("length"===s&&Array.isArray(n))return n[s]=r,!0;{const i=e.reactiveMap.get(n);if(i.root){if(!(n[s]instanceof t))return!1;a.r.set(n[s],r)}else{const t=n[s];n[s]=r,a.r.refresh(i.path,null,t)}return!0}},deleteProperty(n,s){const r=e.reactiveMap.get(n);if(r.root){if(!(n[s]instanceof t))return;a.r.unset(r.path+"."+s)}else{const t=n[s];delete n[s],a.r.refresh(r.path,null,t)}return!0}});return e.reactiveMap.set(n,{path:s,proxy:i,root:r}),i}}e.data={definitions:{},instances:{},instancesCustomEvents:{},instancesRestoreData:{},state:{},stateUpdateEvents:{}};const a={};return a.r={listDefinitions:function(){return Object.keys(e.data.definitions)},listInstances:function(){return Object.keys(e.data.instances)},listInstancesCustomEvents:function(){const t={};for(const a in e.data.instancesCustomEvents)t[a]=Object.keys(e.data.instancesCustomEvents[a]);return t},listInstancesRestoreData:function(){const t={};for(const a in e.data.instancesRestoreData)t[a]=Object.keys(e.data.instancesRestoreData[a]);return t},listState:function(){return Object.keys(e.data.state)},listStateUpdateEvents:function(){const t={};for(const a in e.data.stateUpdateEvents)t[a]=e.data.stateUpdateEvents[a].filter((t=>void 0!==t)).length;return t},define:function(t,a){if(e.data.definitions[t])return!1;const n={};return n.data=a.data??{},n.events=a.events??{},n.methods=a.methods??{},e.data.definitions[t]=n,!0},init:function(n,s){const r=e.data.definitions[s.type];if(!r)return console.error(`Type '${s.type}' not defined!`),!1;if(void 0!==e.data.instances[n])return console.error(`ID '${n}' already exists!`),!1;if(r.el=s.el,r.type=s.type,r.parent=n.includes(".")?n.split(".").slice(0,-1).join("."):"",s.data)for(const t in s.data)r.data.hasOwnProperty(t)&&(r.data[t]=s.data[t]);for(const e in r.data)r.data[e]instanceof t||(a.r.set(n+"."+e,r.data[e]),r.data[e]=a.r.ref(n+"."+e));e.data.instances[n]=e.initReactive(new e(n,r),n),e.data.instancesCustomEvents[n]={};const i=[];if(r.events){if(r.events.create){const t=e.delayRefresh;t||(e.delayRefresh=!0),r.events.create.call(e.data.instances[n]),t||(e.delayRefresh=!1,a.r.refresh(null))}if(r.events.update)for(const t in r.data)r.events.update[t]&&(a.r.attach(r.data[t],r.events.update[t],n),i.push(r.data[t]));r.events.destroy&&e.data.instances[n].$el.on("jqreDestroy",r.events.destroy.bind(e.data.instances[n]));for(const t in r.events)if("create"!==t&&"update"!==t)if("object"==typeof r.events[t])for(const s in r.events[t]){let i=r.events[t][s],d=null,o={};"function"!=typeof i&&(o=i.data??{},d=i.useCapture??null,i=i.handler),e.data.instances[n].$el.on(t,s,o,(function(t){const s=e.delayRefresh;s||(e.delayRefresh=!0),i.call(e.data.instances[n],t),s||(e.delayRefresh=!1,a.r.refresh(null))}),d)}else e.data.instancesCustomEvents[n][t]=r.events[t]}for(const t of i)a.r.refresh(t);return!0},trigger:function(t,a,n=null){return!!e.data.instances.hasOwnProperty(t)&&e.data.instances[t].$emit(a,n)},destroy:function(t){if(e.data.instances.hasOwnProperty(t)){const n=t+".";for(const t in e.data.instances)t.substr(0,n.length)===n&&a.r.destroy(t);e.data.instances[t].$el.trigger("jqreDestroy");for(const t in e.data.state)t.substr(0,n.length)===n&&a.r.unset(t);if(delete e.data.instancesCustomEvents[t],e.data.instancesRestoreData[t]){for(const a in e.data.instancesRestoreData[t])e.data.instances[t].$restore(a);delete e.data.instancesRestoreData[t]}return e.data.instances[t].$el.off(),delete e.data.instances[t],!0}return!1},get:function(t){return"string"!=typeof t&&(t=t.id),t?e.data.state[t]??null:null},ref:function(e){return new t(e)},attach:function(t,a,n=null){if("string"!=typeof t&&(t=t.id),t&&e.data.stateUpdateEvents[t]){for(const s in e.data.stateUpdateEvents[t])if(e.data.stateUpdateEvents[t][s].handler===a&&e.data.stateUpdateEvents[t][s].instanceId===n)return s}else e.data.stateUpdateEvents[t]=[];return e.data.stateUpdateEvents[t].push({handler:a,instanceId:n})-1},deattach:function(t,a=null,n=null){if("string"!=typeof t&&(t=t.id),e.data.stateUpdateEvents[t])if("function"==typeof a){for(const s in e.data.stateUpdateEvents[t])if(e.data.stateUpdateEvents[t][s].handler===a&&e.data.stateUpdateEvents[t][s].instanceId===n)return delete e.data.stateUpdateEvents[t][s],!0}else{if(isNaN(a))return delete e.data.stateUpdateEvents[t],!0;if(e.data.stateUpdateEvents[t][a])return delete e.data.stateUpdateEvents[t][a],!0}return!1},refresh:async function(t,n=null,s=void 0){if(null===t)return void e.refreshDelayedList.forEach((t=>{e.refreshDelayedList.delete(t),a.r.refresh(t.idRef,t.handlerOrIndex,t.oldVal)}));if(e.delayRefresh)return void e.refreshDelayedList.add({idRef:t,handlerOrIndex:n,oldVal:s});"string"!=typeof t&&(t=t.id);let r=!1;const i=e.delayRefresh;if(i||(e.delayRefresh=!0),e.data.stateUpdateEvents[t])if(void 0===s&&(s=a.r.get(t)),n)if("function"==typeof n){for(const a in e.data.stateUpdateEvents[t])if(e.data.stateUpdateEvents[t][a].handler===n){e.data.stateUpdateEvents[t][a].handler.call(e.data.instances[e.data.stateUpdateEvents[t][a].instanceId],s),r=!0;break}}else isNaN(n)||e.data.stateUpdateEvents[t][n]&&(e.data.stateUpdateEvents[t][n].handler.call(e.data.instances[e.data.stateUpdateEvents[t][n].instanceId],s),r=!0);else for(const a in e.data.stateUpdateEvents[t])e.data.stateUpdateEvents[t][a]&&e.data.instances[e.data.stateUpdateEvents[t][a].instanceId]&&(e.data.stateUpdateEvents[t][a].handler.call(e.data.instances[e.data.stateUpdateEvents[t][a].instanceId],s),r=!0);return i||(e.delayRefresh=!1,a.r.refresh(null)),r},set:function(t,n,s=void 0){"string"!=typeof t&&(t=t.id);let r,i=a.r.get(t);if(i=/boolean|number|string/.test(typeof i)?i:JSON.parse(JSON.stringify(i)),void 0===s)r=n;else{if(r=/boolean|number|string/.test(typeof i)?i:JSON.parse(JSON.stringify(i)),"object"!=typeof r||null===r)return!1;r[n]=s}let d=!1;return d=/boolean|number|string/.test(typeof i)&&/boolean|number|string/.test(typeof variable)?i!==r:JSON.stringify(i)!==JSON.stringify(r),d&&(void 0===s?e.data.state[t]=n:e.data.state[t][n]=s,a.r.refresh(t,null,i)),!0},unset:function(t,n=null){"string"!=typeof t&&(t=t.id);const s=a.r.get(t),r=/boolean|number|string/.test(typeof s)?s:JSON.parse(JSON.stringify(s));if(null!==n){if("object"==typeof s&&null!==s&&n in s)return delete e.data.state[t][n],Array.isArray(s)&&(e.data.state[t]=s.filter((t=>void 0!==t))),a.r.refresh(t,null,r),!0}else if(t in e.data.state){if(null==s);else if(Array.isArray(s))e.data.state[t]=[];else switch(typeof s){case"object":e.data.state[t]={};break;case"boolean":e.data.state[t]=!1;break;case"string":e.data.state[t]="";break;case"number":case"bigint":e.data.state[t]=0;break;default:e.data.state[t]=null}return a.r.refresh(t,null,r),delete e.data.state[t],delete e.data.stateUpdateEvents[t],!0}return!1}},a.r.data={definitions:e.data.definitions,instances:e.data.instances,instancesCustomEvents:e.data.instancesCustomEvents,instancesRestoreData:e.data.instancesRestoreData,state:e.data.state,stateUpdateEvents:e.data.stateUpdateEvents,map:e.reactiveMap,refreshDelayedList:e.refreshDelayedList},a.r}()});